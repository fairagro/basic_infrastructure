apiVersion: v1
kind: ConfigMap
metadata:
  name: "{{ include "fairagro-onlyoffice.config" . }}"
data:
  # the postgres operator makes use of self-signed certificates, so we need to tell
  # onlyoffice to skip the certificate validation.
  local.json: |
    {
      "services": {
        "CoAuthoring": {
          "autoAssembly": {
            "enable": true,
            "interval": "5m",
            "step": "1m"
          },
          "sql": {
            "pgPoolExtraOptions": {
              "ssl": {
                "rejectUnauthorized": false
              }
            }
          }
        }
      }
    }
  # set (decrease) ulimits so we do not run in issues with rabbitmq 
  # limits.conf: |
  #   #Each line describes a limit for a user in the form:
  #   #
  #   #<domain>        <type>  <item>  <value>
  #   #
  #   #Where:
  #   #<domain> can be:
  #   #        - a user name
  #   #        - a group name, with @group syntax
  #   #        - the wildcard *, for default entry
  #   #        - the wildcard %, can be also used with %group syntax,
  #   #                 for maxlogin limit
  #   #        - NOTE: group and wildcard limits are not applied to root.
  #   #          To apply a limit to the root user, <domain> must be
  #   #          the literal username root.
  #   #
  #   #<type> can have the two values:
  #   #        - "soft" for enforcing the soft limits
  #   #        - "hard" for enforcing hard limits
  #   #
  #   #<item> can be one of the following:
  #   #        - core - limits the core file size (KB)
  #   #        - data - max data size (KB)
  #   #        - fsize - maximum filesize (KB)
  #   #        - memlock - max locked-in-memory address space (KB)
  #   #        - nofile - max number of open file descriptors
  #   #        - rss - max resident set size (KB)
  #   #        - stack - max stack size (KB)
  #   #        - cpu - max CPU time (MIN)
  #   #        - nproc - max number of processes
  #   #        - as - address space limit (KB)
  #   #        - maxlogins - max number of logins for this user
  #   #        - maxsyslogins - max number of logins on the system
  #   #        - priority - the priority to run user process with
  #   #        - locks - max number of file locks the user can hold
  #   #        - sigpending - max number of pending signals
  #   #        - msgqueue - max memory used by POSIX message queues (bytes)
  #   #        - nice - max nice priority allowed to raise to values: [-20, 19]
  #   #        - rtprio - max realtime priority
  #   #        - chroot - change root to directory (Debian-specific)
  #   #
  #   #<domain>      <type>  <item>         <value>
  #   #

  #   # rabbitmq has issues if this is set to a very high value (which is the default case on fizz)
  #   *                soft    nofile          65536
  #   *                hard    nofile          65536

  #   # End of file
