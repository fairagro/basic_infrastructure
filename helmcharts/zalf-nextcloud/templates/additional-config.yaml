apiVersion: v1
kind: ConfigMap
metadata:
  name: nextcloud-additional-config
data:
  proxy.config.php: |
    <?php
    $CONFIG = array (
      'trusted_proxies' => array(
        0 => '127.0.0.1',
        1 => '{{ .Values.allowed_reverse_proxy_ips }}',
      ),
      'forwarded_for_headers' => array('HTTP_X_FORWARDED_FOR'),
    );
  trusted_domains.config.php: |
    <?php
    $CONFIG = array (
      'trusted_proxies' => array(
{{- $idx := 0 -}}
{{- if .Values.nextcloud_internal_ingress.fqdn }}
        {{ $idx }} => '{{ .Values.nextcloud_internal_ingress.fqdn }}'
{{- $idx := $idx + 1 -}}
{{- end }}
{{- if .Values.nextcloud_external_ingress.fqdn }}
        {{ $idx }} => '{{ .Values.nextcloud_external_ingress.fqdn }}',
{{- end }}
      ),
    );